Number.isNaN=Number.isNaN||function(t){return t!=t},function($){function r(t){this.logprefix="Widget PhotoBase ("+t.cPath+"): ",this.options=t,this.imagesLeft=t.imagesLeft,this.selectors={container:"#"+t.containerId,list:"#"+t.containerId+" ul",item:"li",picture:"."+t.cClass+"-uro-item",active:"#"+t.containerId+" ."+t.cClass+"-active",lightBoxClickHandler:"li",lightBoxClickHandlerAlt:"."+t.cClass+"-lbTrigger"},this.classes={title:t.cClass+"-title",active:t.cClass+"-active",hide:t.cClass+"-hide"},this.events={loadMore:t.cPrefix+"-loadMore",loadEnd:t.cPrefix+"-loadEnd",imagesLoad:t.cPrefix+"-imagesLoad",show:t.cPrefix+"-show",lightBoxNavigation:t.cPrefix+"-lightBoxNavigation",lightBoxInit:t.cPrefix+"-lightBoxInit",lightBoxDestroy:t.cPrefix+"-lightBoxDestroy",lightBoxSetClickDelegate:t.cPrefix+"-lightBoxSetClickDelegate"},this.loadMoreMinCount=2}window.cm4widget=window.cm4widget||{},window.cm4widget.slideshow=window.cm4widget.slideshow||{},window.cm4widget.slideshow.PhotoBase||(r.datakey={ORIGININDEX:"index",DESC:"desc",TITLE:"title",PSWPID:"pswpId",INVALID:"invalid"},r.isValidItem=function(t){return!(!t||!t.dataset||/error|empty/.test(t.dataset[r.datakey.INVALID]))},r.debounce=function(e,i,o){function n(){a&&clearTimeout(a)}function t(){var t=this,s=arguments;o&&!a&&e.apply(t,s),n(),a=setTimeout(function(){e.apply(t,s)},i)}var a;return t.clear=n,t},r.prototype.show=function(){this.options.debug&&console.log(this.logprefix,"widget show");var t=$(this.selectors.container);t.css("opacity",1),this.options.debug&&console.log(this.logprefix,"trigger ",this.events.show),t.trigger(this.events.show,[t]),this.options.isLinkTeaser&&(clearInterval(this.slideTimer),t.find(this.selectors.item).first().addClass(this.classes.active),this.options.isPreview||(this.slideTimer=setInterval(this.slide.bind(this),4e3)))},r.prototype.slide=function(){var t=$(this.selectors.active),s=t.next(),e=$(this.selectors.list).find(this.selectors.item),s=(t.removeClass(this.classes.active),(s[0]?s:e.first()).addClass(this.classes.active),this.getOriginIndex(t));Number.isNaN(s)||0<this.imagesLeft&&s>this.loadMoreLevel&&this.loadMore()},r.prototype.setLightBoxClickDelegate=function(t){this.options.debug&&console.log(this.logprefix,"trigger ",this.events.lightBoxSetClickDelegate),$(this.selectors.container).trigger(this.events.lightBoxSetClickDelegate,[t])},r.prototype.loadMore=function(t){this.options.debug&&console.log(this.logprefix,"loading items from backend");var e=t||this.loadMoreMinCount,t=this.options.imagesCount-this.imagesLeft,i=(this.imagesLeft-=e,this);return $.ajax({url:i.options.endpoint.photos,data:{offset:t,length:e},dataType:"html",cache:!1,success:function(t,s){t?0<(t=$(t).filter(function(){return 1===this.nodeType})).length?(i.options.debug&&console.log(i.logprefix,"trigger ",i.events.loadMore),$(i.selectors.container).trigger(i.events.loadMore,[t]),i.imageLoad(t)):0<i.imagesLeft&&i.loadMore(e):console.error(i.logprefix,"No content")},error:function(){console.error(i.logprefix,arguments)}})},r.prototype.imageLoad=function(t){var s,e=t,n=(e instanceof $?this.options.debug&&console.log(this.logprefix,"preloading given items: ",e.length):(e=$(this.selectors.container).find(this.selectors.item),this.options.debug&&console.log(this.logprefix,"preloading items for default container: ",e.length)),this),a=[],l=$(),i=(e.each(function(t,s){var e,i=$(s).find(n.selectors.picture).clone(),o=i.find("img");o[0]?(e=new $.Deferred,o.css({position:"fixed",top:"-99999px"}).bind("load",e.resolve).bind("error",function(){s.dataset[r.datakey.INVALID]="error",n.options.isPreview||s.classList.add(n.classes.hide),e.resolve()}),a.push(e.promise())):s.dataset[r.datakey.INVALID]="empty",l.append(i)}),new $.Deferred);return 0<a.length?(s=$("<div />").append(l),$("body").append(s),$.when.apply($,a).done(function(){s.remove(),n.options.debug&&console.log(n.logprefix,"trigger ",n.events.imagesLoad),$(n.selectors.container).trigger(n.events.imagesLoad,[e]),window.setTimeout(function(){i.resolve(e)},0)})):(this.options.debug&&console.warn(this.logprefix,"no images loaded"),i.reject()),i.always(function(){n.imagesLeft<=0&&(n.options.debug&&console.log(n.logprefix,"trigger ",n.events.loadEnd),$(n.selectors.container).trigger(n.events.loadEnd))}),i.promise()},r.prototype.getOriginIndex=function(t){t=t instanceof $?t[0]:t;return t&&t.dataset?parseInt(t.dataset[r.datakey.ORIGININDEX],10):void 0},window.cm4widget.slideshow.PhotoBase=r)}(jQuery),function($,a){var l,r;function t(t,s){var e,i,o=s,n=!1;this.disable=function(){n=!0,this.stop()},this.enable=function(){n=!1},this.pause=function(){window.clearTimeout(e),o-=Date.now()-i},this.resume=function(){n||(i=Date.now(),window.clearTimeout(e),e=window.setTimeout(t,o))},this.start=function(){n||(o=s,this.resume())},this.stop=function(){o=s,window.clearTimeout(e)}}function s(t){a.call(this,t),this.logprefix="Widget PhotoSlideshow ("+t.cPath+"): ",this.aspectRatioHW=2/3,this.$active=null,this.loadEnd=!1,$.extend(this.classes,{fix:t.cClass+"-fix",animationIn:t.cClass+"-in",animationOut:t.cClass+"-out",animationNext:t.cClass+"-n",animationPrevious:t.cClass+"-p",dotActive:t.cClass+"-active",dotRange:t.cClass+"-range",dotLess:t.cClass+"-less",dotMore:t.cClass+"-more",desc:t.cClass+"-desc",cm4allH1:"cm-h1",touch:t.cClass+"-touch",swipeRight:t.cClass+"-swipe-r",swipeLeft:t.cClass+"-swipe-l",thumbnailList:t.cClass+"-thumbnail-list",thumbnailItem:t.cClass+"-thumbnail-item"}),$.extend(this.selectors,{dots:this.selectors.container+" ."+t.cClass+"-dots",dotItem:"i",thumbnailList:this.selectors.container+" ."+this.classes.thumbnailList,thumbnailItem:"."+this.classes.thumbnailItem,previous:this.selectors.container+" ."+t.cClass+"-prev",next:this.selectors.container+" ."+t.cClass+"-next"}),this.events.swipe=t.cClass+"-swipe",this.events.next=t.cClass+"-next",this.maxDotCount=this.options.dots?7:1,this.maxThumbnailCount=this.options.thumbs?8:1,this.setLoadMoreMinCount()}window.cm4widget=window.cm4widget||{},window.cm4widget.slideshow=window.cm4widget.slideshow||{},window.cm4widget.slideshow.PhotoSlideshow||(l=10*window.devicePixelRatio,((s.prototype=Object.create(a.prototype)).constructor=s).prototype.init=function(){this.options.debug&&(console.log(this.logprefix,"widget ready"),console.log(this.logprefix,"Options are:",this.options));var i,o=this,n=$(this.selectors.container);n.one(this.events.loadEnd,function(){o.options.debug&&console.log(o.logprefix,"consume ",o.events.loadEnd),o.loadEnd=!0}),n.on(this.events.next,function(t,s){o.options.debug&&console.log(o.logprefix,"consume ",o.events.next),o.showNext()}),this.options.autoplay?(this.autoplay=new t(function(){o.showNext()},1e3*(this.options.viewTime||3)+800),$(this.selectors.list).on("mouseenter",this.autoplay.pause).on("mouseleave",this.autoplay.resume),"ontouchstart"in window&&n.on("touchstart",this.autoplay.stop),this.options.lightbox&&n.on(o.events.lightBoxInit,function(){o.autoplay.disable()}).on(o.events.lightBoxDestroy,function(){o.autoplay.enable(),o.autoplay.start()})):this.autoplay=null,this.imageLoad().done(function(t){o.options.debug&&console.log(o.logprefix,"init"),o.options.isLinkTeaser||(o.setActive($(t[0])),o.$active.addClass(o.classes.animationIn)),o.fixAspectRatio(t),o.addInfo(t),o.addDots(t),o.addThumbnails(t),o.updateNavigationAndControls(),o.show(),o.options.isPreview||(n.on(o.events.loadMore,function(t,s){$(o.selectors.list).append(s)}),n.on(o.events.imagesLoad,function(t,s){o.options.debug&&console.log(o.logprefix,"Images are loaded.."),s&&0<s.length?(o.fixAspectRatio(s),o.addInfo(s),o.addDots(s),o.addThumbnails(s),o.updateNavigationAndControls()):(o.options.debug&&console.warn(o.logprefix,"No items loaded (invalid), loading more images.."),o.loadMore())}),o.autoplay&&o.autoplay.start(),o.options.debug&&console.log(o.logprefix,"init done"))}),this.options.isPreview||this.options.isLinkTeaser||(this.options.arrows&&($(this.selectors.previous).on("click",function(){o.showPrevious()}),$(this.selectors.next).on("click",function(){o.showNext()})),this.options.dots&&$(this.selectors.dots).on("click",o.selectors.dotItem,function(){o.showItemByIndex(o.getOriginIndex(this))}),this.options.thumbs&&($(this.selectors.thumbnailList).on("click",o.selectors.thumbnailItem,function(){o.showItemByIndex(o.getOriginIndex(this))}),$(window).on("resize orientationchange",a.debounce(o.refreshThumbnails.bind(o),50,!0))),this.options.lightbox&&n.on(o.events.lightBoxNavigation,function(t,s){o.showItemByIndex(s)}),"ontouchstart"in window&&(this.options.debug&&console.log(o.logprefix,"Touch detected"),n.addClass(this.classes.touch)),n.on("touchstart mousedown",this.selectors.list,function(t){t=t.originalEvent instanceof MouseEvent?t.originalEvent:t.originalEvent.changedTouches[0];i={x:t.pageX,y:t.pageY,start:+new Date},window.clearTimeout(r),r=window.setTimeout(function(){n.find("."+o.classes.swipeLeft+", ."+o.classes.swipeRight).css({width:"0%",opacity:0})},2e3)}).on("touchmove mousemove",this.selectors.list,function(t){var s,e;void 0===i||(s=(e=t.originalEvent instanceof MouseEvent?t.originalEvent:t.originalEvent.changedTouches[0]).pageX-i.x,e=e.pageY-i.y,45<90-180*Math.atan(Math.abs(e)/Math.abs(s))/Math.PI&&t.preventDefault(),0<s&&o.$active.is(":first-child")&&!o.loadEnd)||(+new Date-i.start<=2e3?(e=Math.min(16,Math.abs(Math.round(25/n.width()*s))),n.find("."+(s<0?o.classes.swipeLeft:o.classes.swipeRight)).css({width:e+"%",opacity:Math.min(.2,2*e/100)})):(i=void 0,window.clearTimeout(r),n.find("."+o.classes.swipeLeft+", ."+o.classes.swipeRight).css({width:"0%",opacity:0})))}).on("touchend mouseup",this.selectors.list,function(t){var s,e;void 0!==i&&(s=(e=t.originalEvent instanceof MouseEvent?t.originalEvent:t.originalEvent.changedTouches[0]).pageX-i.x,e=e.pageY-i.y,0!=s||0!=e)&&(45<90-180*Math.atan(Math.abs(e)/Math.abs(s))/Math.PI&&(+new Date-i.start<=2e3&&Math.abs(s)>l&&(s<0?(o.showNext(),o.options.debug&&console.log(o.logprefix,"trigger ",o.events.swipe),n.trigger(o.events.swipe)):o.$active.is(":first-child")&&!o.loadEnd||(o.showPrevious(),o.options.debug&&console.log(o.logprefix,"trigger ",o.events.swipe),n.trigger(o.events.swipe))),t.preventDefault()),i=void 0,window.clearTimeout(r),n.find("."+o.classes.swipeLeft+", ."+o.classes.swipeRight).css({width:"0%",opacity:0}))}))},s.prototype.fixAspectRatio=function(t){var e;t instanceof $&&0!==t.length&&(e=this,t.each(function(){var t,s=this.querySelector("img");s&&(t=s.naturalWidth,s.naturalHeight/t<e.aspectRatioHW)&&this.classList.add(e.classes.fix)}))},s.prototype.setLoadMoreMinCount=function(){var t=Math.max(Math.floor(this.maxDotCount/2),Math.floor(this.maxThumbnailCount/2),2);this.loadMoreMinCount!==t&&(this.loadMoreMinCount=t,this.options.debug)&&console.log(this.logprefix,"load more pictures count ",this.loadMoreMinCount)},s.prototype.setActive=function(t){this.$active=t,this.options.lightbox&&this.setLightBoxClickDelegate(t[0])},s.prototype.addDots=function(t){var s;this.options.dots&&t instanceof $&&0!==t.length&&(this.options.debug&&console.log(this.logprefix,"adding dots: ",t.length),s=this,t.each(function(){var t=document.createElement("i");t.dataset[a.datakey.ORIGININDEX]=s.getOriginIndex(this),$(s.selectors.dots).append(t)}))},s.prototype.addThumbnails=function(t){var s;this.options.thumbs&&t instanceof $&&0!==t.length&&(this.options.debug&&console.log(this.logprefix,"adding thumbnails:",t.length),t=t.clone(),this.clearAnimationClasses(t),t.children("."+this.classes.title).remove(),t.children("."+this.classes.desc).remove(),s=this,t.each(function(){this.classList.add(s.classes.thumbnailItem),delete this.dataset[a.datakey.DESC],delete this.dataset[a.datakey.TITLE],delete this.dataset[a.datakey.PSWPID]}),$(this.selectors.thumbnailList).append(t))},s.prototype.clearAnimationClasses=function(t){var s=this;t.each(function(){this.classList.remove(s.classes.animationIn),this.classList.remove(s.classes.animationOut),this.classList.remove(s.classes.animationPrevious),this.classList.remove(s.classes.animationNext)})},s.prototype.nextItem=function(t){t=(t||this.$active).next();return t=t[0]?t:$(this.selectors.list).find(this.selectors.item).first()},s.prototype.previousItem=function(t){t=(t||this.$active).prev();return t=t[0]?t:$(this.selectors.list).find(this.selectors.item).last()},s.prototype.showItem=function(t,s){var e,i;this.autoplay&&this.autoplay.start(),this.$active[0]!==t[0]&&(e=$(this.selectors.list).find(this.selectors.item),this.clearAnimationClasses(e),e=this.getOriginIndex(this.$active),i=this.getOriginIndex(t),"next"===s||"prev"!==s&&e<i?(this.$active[0].classList.add(this.classes.animationOut),this.$active[0].classList.add(this.classes.animationNext),t[0].classList.add(this.classes.animationIn),t[0].classList.add(this.classes.animationNext)):(this.$active[0].classList.add(this.classes.animationOut),this.$active[0].classList.add(this.classes.animationPrevious),t[0].classList.add(this.classes.animationIn),t[0].classList.add(this.classes.animationPrevious)),this.setActive(t),0<this.imagesLeft&&i>this.options.imagesCount-this.imagesLeft-this.loadMoreMinCount&&this.loadMore(),this.updateNavigationAndControls(i))},s.prototype.showNext=function(){this.showItem(this.nextItem(),"next")},s.prototype.showPrevious=function(){this.showItem(this.previousItem(),"prev")},s.prototype.showItemByIndex=function(t){var s,e=this.getOriginIndex(this.$active);t!==e&&(e=$((s=this).selectors.list).find(this.selectors.item).filter(function(){return s.getOriginIndex(this)===t}),this.showItem(e))},s.prototype.refreshThumbnails=function(t){if(this.options.thumbs){var s=t||this.getOriginIndex(this.$active),e=document.querySelector(this.selectors.thumbnailList);if(e&&"horizontal"===this.options.thumbs){var i=e.querySelectorAll(this.selectors.thumbnailItem);if(0!==i.length){var o=e.getBoundingClientRect().width,n=i[0].getBoundingClientRect().width,t=n*i.length;if(t<o)e.style.left=o/2-t/2+"px";else for(var a=t-o,l=i.length,r=0;r<l;++r)if(h=i[r],this.getOriginIndex(h)===s){var h=o/2-(h.offsetLeft+n/2);(h=0<h?0:h)<-a&&(h=-a),e.style.left=h+"px";break}this.maxThumbnailCount=Math.floor(o/n),this.setLoadMoreMinCount()}}}},s.prototype.addInfo=function(t){var o;(this.options.title||this.options.desc)&&t instanceof $&&0!==t.length&&(o=this,t.each(function(){var t,s=$(this),e=this.dataset[a.datakey.TITLE],i=this.dataset[a.datakey.DESC];(i||e)&&(t=$('<div class="'+o.classes.title+'"></div>'),e&&o.options.title&&t.append($("<span />").addClass(o.classes.cm4allH1).text(e)),i&&o.options.desc&&t.append($("<span />").text(i)),s.append(t))}))},s.prototype.updateNavigationAndControls=function(t){this.options.debug&&console.log(this.logprefix,"updating controls");var s=t||this.getOriginIndex(this.$active);if(this.options.dots){var e,t=$(this.selectors.dots).find(this.selectors.dotItem),i=(this.loadEnd&&(this.maxDotCount=Math.min(t.length,this.maxDotCount)),this.setLoadMoreMinCount(),this);if(t.removeClass(this.classes.dotActive).removeClass(this.classes.dotRange).toArray().some(function(t){return e=$(t),i.getOriginIndex(t)===s&&(e.addClass(i.classes.dotActive),!0)}),e&&0!==e){for(var o=Math.floor(this.maxDotCount/2),n=o,a=o,l=e.prevAll(),r=e.nextAll(),h=(l.length<o&&(a+=o-(n=l.length)),r.length<o&&(n+=o-(a=r.length)),e);n;)--n,(h=h.prev()).addClass(this.classes.dotRange);for(var c=e;a;)--a,(c=c.next()).addClass(this.classes.dotRange);t.length>this.maxDotCount&&(l.length>o?$(this.selectors.dots).addClass(this.classes.dotLess):$(this.selectors.dots).removeClass(this.classes.dotLess),r.length>o||!this.loadEnd?$(this.selectors.dots).addClass(this.classes.dotMore):$(this.selectors.dots).removeClass(this.classes.dotMore))}}this.options.arrows&&(this.$active.is(":first-child")&&!this.loadEnd?$(this.selectors.previous).hide():$(this.selectors.previous).show()),this.refreshThumbnails(s)},window.cm4widget.slideshow.PhotoSlideshow=s)}(jQuery,window.cm4widget.slideshow.PhotoBase);