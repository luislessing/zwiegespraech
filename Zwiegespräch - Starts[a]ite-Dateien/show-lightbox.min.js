window.cm4widget=window.cm4widget||{},window.cm4widget.slideshow=window.cm4widget.slideshow||{},window.cm4widget.slideshow.PhotoSwipeUI||(window.cm4widget.slideshow.PhotoSwipeUI=function(n,r){function e(){var e=1===C.getNumItemsFn();e!==x&&(k(d,"ui--one-slide",e),x=e)}function o(e){for(var t=0;t<C.closeElClasses.length;t+=1)if(r.hasClass(e,"pswp__"+C.closeElClasses[t]))return!0;return!1}function l(){clearTimeout(E),S=0,g&&y.setIdle(!1)}function i(e){(e=e.relatedTarget||e.toElement)&&"HTML"!==e.nodeName||(clearTimeout(E),E=setTimeout(function(){y.setIdle(!0)},C.timeToIdleOutside))}function s(e){if(T)return!0;C.timeToIdle&&C.mouseUsed&&!g&&l();for(var t,o,n=(e.target||e.srcElement).getAttribute("class")||"",i=0;i<L.length;i+=1)(t=L[i]).onTap&&-1<n.indexOf("pswp__"+t.name)&&(t.onTap(),o=!0);o&&(e.stopPropagation&&e.stopPropagation(),T=!0,e=r.features.isOldAndroid?600:30,setTimeout(function(){T=!1},e))}function a(e){b!==e&&(k(v,"preloader--active",!e),b=e)}function p(e){var t,o=e.vGap;!n.likelyTouchDevice||C.mouseUsed||window.screen.width>C.fitControlsWidth?(t=C.barsSize,C.captionEl&&"auto"===t.bottom?(h||((h=r.createEl("pswp__caption pswp__caption--fake")).appendChild(r.createEl("pswp__caption__center")),d.insertBefore(h,m),r.addClass(d,"pswp__ui--fit")),C.addCaptionHTMLFn(e,h,!0)?(e=h.clientHeight,o.bottom=parseInt(e,10)||44):o.bottom=t.top):o.bottom="auto"===t.bottom?0:t.bottom,o.top=t.top):(o.top=0,o.bottom=0)}function c(){function e(e){if(e)for(var t=e.length,o=0;o<t;o+=1){i=e[o],l=i.className;for(var n=0;n<L.length;n+=1)s=L[n],-1<l.indexOf("pswp__"+s.name)&&(C[s.option]?(r.removeClass(i,"pswp__element--disabled"),s.onInit&&s.onInit(i)):r.addClass(i,"pswp__element--disabled"))}}e(d.children);var i,l,s,t=r.getChildByClass(d,"pswp__top-bar");t&&e(t.children)}var u,d,m,h,t,w,g,f,v,b,I,x,C,T,_,E,y=this,F=!1,A=!0,P={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,indexIndicatorSep:" / ",fitControlsWidth:1200},k=function(e,t,o){r[(o?"add":"remove")+"Class"](e,"pswp__"+t)},S=0,L=[{name:"caption",option:"captionEl",onInit:function(e){m=e}},{name:"button--zoom",option:"zoomEl",onTap:n.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(e){t=e}},{name:"button--close",option:"closeEl",onTap:n.close},{name:"button--arrow--left",option:"arrowEl",onTap:n.prev},{name:"button--arrow--right",option:"arrowEl",onTap:n.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){u.isFullscreen()?u.exit():u.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(e){v=e}}];y.init=function(){var t;r.extend(n.options,P,!0),C=n.options,d=r.getChildByClass(n.scrollWrap,"pswp__ui"),(f=n.listen)("onVerticalDrag",function(e){A&&e<.95?y.hideControls():!A&&.95<=e&&y.showControls()}),f("onPinchClose",function(e){A&&e<.9?(y.hideControls(),t=!0):t&&!A&&.9<e&&y.showControls()}),f("zoomGestureEnded",function(){(t=!1)&&!A&&y.showControls()}),f("beforeChange",y.update),f("doubleTap",function(e){var t=n.currItem.initialZoomLevel;n.getZoomLevel()!==t?n.zoomTo(t,e,333):n.zoomTo(C.getDoubleTapZoom(!1,n.currItem),e,333)}),f("preventDragEvent",function(e,t,o){var n=e.target||e.srcElement;n&&n.getAttribute("class")&&-1<e.type.indexOf("mouse")&&(0<n.getAttribute("class").indexOf("__caption")||/(SMALL|STRONG|EM)/i.test(n.tagName))&&(o.prevent=!1)}),f("bindEvents",function(){r.bind(d,"pswpTap click",s),r.bind(n.scrollWrap,"pswpTap",y.onGlobalTap),n.likelyTouchDevice||r.bind(n.scrollWrap,"mouseover",y.onMouseOver)}),f("unbindEvents",function(){_&&clearInterval(_),r.unbind(document,"mouseout",i),r.unbind(document,"mousemove",l),r.unbind(d,"pswpTap click",s),r.unbind(n.scrollWrap,"pswpTap",y.onGlobalTap),r.unbind(n.scrollWrap,"mouseover",y.onMouseOver),u&&(r.unbind(document,u.eventK,y.updateFullscreen),u.isFullscreen()&&(C.hideAnimationDuration=0,u.exit()),u=null)}),f("destroy",function(){C.captionEl&&(h&&d.removeChild(h),r.removeClass(m,"pswp__caption--empty")),r.removeClass(d,"pswp__ui--over-close"),r.addClass(d,"pswp__ui--hidden"),y.setIdle(!1)}),C.showAnimationDuration||r.removeClass(d,"pswp__ui--hidden"),f("initialZoomIn",function(){C.showAnimationDuration&&r.removeClass(d,"pswp__ui--hidden")}),f("initialZoomOut",function(){r.addClass(d,"pswp__ui--hidden")}),f("parseVerticalMargin",p),c(),e(),C.timeToIdle&&f("mouseUsed",function(){r.bind(document,"mousemove",l),r.bind(document,"mouseout",i),_=setInterval(function(){2===(S+=1)&&y.setIdle(!0)},C.timeToIdle/2)}),C.fullscreenEl&&!r.features.isOldAndroid&&((u=u||y.getFullscreenAPI())?(r.bind(document,u.eventK,y.updateFullscreen),y.updateFullscreen(),r.addClass(n.template,"pswp--supports-fs")):r.removeClass(n.template,"pswp--supports-fs")),C.preloaderEl&&(a(!0),f("beforeChange",function(){clearTimeout(I),I=setTimeout(function(){n.currItem&&n.currItem.loading?n.allowProgressiveImg()&&(!n.currItem.img||n.currItem.img.naturalWidth)||a(!1):a(!0)},C.loadingIndicatorDelay)}),f("imageLoadComplete",function(e,t){n.currItem===t&&a(!0)}))},y.setIdle=function(e){k(d,"ui--idle",g=e)},y.update=function(){F=!(!A||!n.currItem||(y.updateIndexIndicator(),C.captionEl&&(C.addCaptionHTMLFn(n.currItem,m),k(m,"caption--empty",!n.currItem.title)),0)),e()},y.updateFullscreen=function(e){e&&setTimeout(function(){n.setScrollOffset(0,r.getScrollY())},50),r[(u.isFullscreen()?"add":"remove")+"Class"](n.template,"pswp--fs")},y.updateIndexIndicator=function(){C.counterEl&&(t.innerHTML=n.getCurrentIndex()+1+C.indexIndicatorSep+C.getNumItemsFn())},y.onGlobalTap=function(e){var t=e.target||e.srcElement;T||(e.detail&&"mouse"===e.detail.pointerType?o(t)?n.close():r.hasClass(t,"pswp__img")&&(1===n.getZoomLevel()&&n.getZoomLevel()<=n.currItem.fitRatio?C.clickToCloseNonZoomable&&n.close():n.toggleDesktopZoom(e.detail.releasePoint)):(C.tapToToggleControls&&(A?y.hideControls():y.showControls()),C.tapToClose&&(r.hasClass(t,"pswp__img")||o(t))&&n.close()))},y.onMouseOver=function(e){e=e.target||e.srcElement;k(d,"ui--over-close",o(e))},y.hideControls=function(){r.addClass(d,"pswp__ui--hidden"),A=!1},y.showControls=function(){A=!0,F||y.update(),r.removeClass(d,"pswp__ui--hidden")},y.supportsFullscreen=function(){return!!(document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen)},y.getFullscreenAPI=function(){var e,t=document.documentElement,o="fullscreenchange";return t.requestFullscreen?e={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:o}:t.mozRequestFullScreen?e={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+o}:t.webkitRequestFullscreen?e={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+o}:t.msRequestFullscreen&&(e={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),e&&(e.enter=function(){return w=C.closeOnScroll,C.closeOnScroll=!1,"webkitRequestFullscreen"===this.enterK?n.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT):n.template[this.enterK]()},e.exit=function(){return C.closeOnScroll=w,document[this.exitK]()},e.isFullscreen=function(){return document[this.elementK]}),e}}),function($,u,l,s){var r,a,p,e,t;function o(e,t){this.logprefix="PhotoLightBox: ",this.photoAlbum=e,this.debug=t.debug,this.endpoint=t.endpoint.photoswipeTemplate,this.isShowTitle=t.isShowTitle,this.text=t.text,this.templateId=t.templateId,this.pictureItems=[],this.pswp=void 0,this.clickDelegate=void 0}window.cm4widget=window.cm4widget||{},window.cm4widget.slideshow=window.cm4widget.slideshow||{},window.cm4widget.slideshow.PhotoLightBox||(r="pswp__title cm-h1",a="pswp__desc cm-templates-text",p="pswp__error-msg",e="button.pswp__button.pswp__button--arrow--left",t="button.pswp__button.pswp__button--arrow--right",o.prototype.init=function(){var n=this,i=(this.refreshPswp=u.debounce(function(e){n.pswp&&(n.invalidateCurrItems(),n.updateSize(!0),n.debug)&&console.log(n.logprefix,"Refresh Photoswipe")},500,!0),$(this.photoAlbum.selectors.container));i.on(this.photoAlbum.events.imagesLoad,function(e,t){n.parsePictures(n.pictureItems,t),n.pswp&&(n.pswp.ui.update(),n.toogleLeftRightButtons())}),this.loadTemplate().done(function(o){function e(e){var t;this instanceof window.HTMLElement?(t=parseInt(this.dataset[u.datakey.PSWPID],10),Number.isNaN(t)?console.error(n.logprefix,"No index given, was: ",this.dataset[u.datakey.PSWPID]):(t={index:t,loop:!1,history:!1,bgOpacity:.85,errorMsg:'<div class="'+p+'" data-url="%url%">'+n.text.error+"</div>",getThumbBoundsFn:function(){var e=n.pswp.getCurrentIndex();if(n.pictureItems[e]&&n.pictureItems[e].el)return{x:(e=$(n.pictureItems[e].el)).offset().left,y:e.offset().top,w:e.width()}},addCaptionHTMLFn:function(e,t,o){t=$(t).empty();return!!(n.isShowTitle&&e.title||e.desc)&&(n.isShowTitle&&e.title&&"-"!==e.title&&t.append($('<div class="'+r+'"/>').text(e.title)),e.desc&&t.append($('<div class="'+a+'"/>').text(e.desc)),!0)}},n.pswp=new s(o,l,n.pictureItems,t),n.pswp.init(),n.loadMoreOnPswpAction(),n.debug&&console.log(n.logprefix,"trigger ",n.photoAlbum.events.lightBoxInit,":",n.pswp.currItem.cm4allIndex),i.trigger(n.photoAlbum.events.lightBoxInit,[n.pswp.currItem.cm4allIndex]),n.pswp.listen("beforeChange",function(){n.debug&&console.log(n.logprefix,"trigger ",n.photoAlbum.events.lightBoxNavigation,":",n.pswp.currItem.cm4allIndex),i.trigger(n.photoAlbum.events.lightBoxNavigation,[n.pswp.currItem.cm4allIndex]),n.loadMoreOnPswpAction()}),n.pswp.listen("destroy",function(){n.debug&&console.log(n.logprefix,"trigger ",n.photoAlbum.events.lightBoxDestroy,":",n.pswp.currItem.cm4allIndex),i.trigger(n.photoAlbum.events.lightBoxDestroy,[n.pswp.currItem.cm4allIndex]),n.pswp=void 0}))):console.error(n.logprefix,"Click-delegate not a HTMLElement, was: ",this)}0!==i.find(n.photoAlbum.selectors.lightBoxClickHandlerAlt).length?i.on("click",n.photoAlbum.selectors.lightBoxClickHandlerAlt,function(){e.call(n.clickDelegate)}):i.on("click",n.photoAlbum.selectors.lightBoxClickHandler,e)}),0!==i.find(n.photoAlbum.selectors.lightBoxClickHandlerAlt).length&&i.on(n.photoAlbum.events.lightBoxSetClickDelegate,function(e,t){n.debug&&console.log(n.logprefix,"consume ",n.photoAlbum.events.lightBoxSetClickDelegate),n.clickDelegate=t})},o.prototype.preventLeftRightKey=function(e){this.pswp&&(0===this.pswp.getCurrentIndex()?37===e.keyCode&&e.stopPropagation():this.pswp.getCurrentIndex()===this.pswp.items.length-1&&39===e.keyCode&&e.stopPropagation())},o.prototype.loadTemplate=function(){var t=this,o=new $.Deferred;return document.getElementById(this.templateId)?o.resolveWith(o.promise(),[document.getElementById(t.templateId)]):t.endpoint?$.ajax({url:t.endpoint,dataType:"html",success:function(e){e?(e=$(e).filter(function(){return 1===this.nodeType}),$("body").append(e),e.on("keydown",t.preventLeftRightKey.bind(t)),o.resolveWith(o.promise(),[e[0]])):console.error(t.logprefix,"No content for template")},error:function(){console.error(t.logprefix,arguments)}}):console.error(t.logprefix,"Missing URL to load template."),o.promise()},o.prototype.toogleLeftRightButtons=function(){this.pswp&&(0===this.pswp.getCurrentIndex()?($(e).hide(),$(t).show()):this.pswp.getCurrentIndex()===this.pswp.items.length-1?($(e).show(),$(t).hide()):($(e).show(),$(t).show()))},o.prototype.loadMoreOnPswpAction=function(){this.pswp&&(this.pswp.getCurrentIndex()>=this.pswp.items.length-3&&0<this.photoAlbum.imagesLeft?this.photoAlbum.loadMore():this.toogleLeftRightButtons())},o.prototype.parsePictures=function(p,e){var c;this.debug&&console.log(this.logprefix,"Parse for pictures"),p&&e instanceof $&&(c=this,e.each(function(e,t){if(u.isValidItem(t)){var o=$(t).find("img")[0];if(o){var n=c.photoAlbum.getOriginIndex(t);if(!Number.isNaN(n)){for(var i=p.length,l=0;l<i;l+=1)if(p[l].cm4allIndex===n)return;var s=t.dataset[u.datakey.TITLE],r=t.dataset[u.datakey.DESC],a=(t.dataset[u.datakey.PSWPID]=p.length,{src:o.currentSrc||o.src,w:o.naturalWidth*window.devicePixelRatio,h:o.naturalHeight*window.devicePixelRatio,title:s||"-",desc:r,el:o,cm4allIndex:n});p.push(a),o.onload=function(){a.w<o.naturalWidth&&(a.src=o.currentSrc||o.src,a.w=o.naturalWidth*window.devicePixelRatio,a.h=o.naturalHeight*window.devicePixelRatio,c.refreshPswp())}}}}}))},window.cm4widget.slideshow.PhotoLightBox=o)}(jQuery,window.cm4widget.slideshow.PhotoBase,window.cm4widget.slideshow.PhotoSwipeUI,window.PhotoSwipe);